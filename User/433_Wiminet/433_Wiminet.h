#ifndef _433_WIMINET_H_
#define _433_WIMINET_H_
#include "stm32f10x.h"

//------------------------------------------------------------------------------
// DESCRIPTION: 请求命令字的起始序号
// -----------------------------------------------------------------------------
#define CMDMSG_BASE                       0X00
// -----------------------------------------------------------------------------
// DESCRIPTION: 其他类设备:请求命令字的起始序号
// -----------------------------------------------------------------------------
#define MACHINE_CMDBASE                   ( CMDMSG_BASE + 0X70 ) 
// -----------------------------------------------------------------------------
// DESCRIPTION: 其他类设备的请求命令字:读取根节点MAC地址
// -----------------------------------------------------------------------------
#define CMDMSG_GET_COORDINATOR_ID         ( MACHINE_CMDBASE + 0X06 )


// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#if defined ( __CC_ARM ) 

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#pragma push

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#pragma pack( 1 )

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#endif



//结构体声明
// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
typedef struct _NodeMsg
{
   // --------------------------------------------------------------------------
   // DESCRIPTION: 同步字符
   // --------------------------------------------------------------------------
   unsigned char                                               m_iHeader;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文操作命令
   // --------------------------------------------------------------------------
   unsigned char                                               m_iOpCode;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 可选操作参数-A
   // --------------------------------------------------------------------------
   unsigned char                                               m_iValueA;
      
   // --------------------------------------------------------------------------
   // DESCRIPTION: 可选操作参数-B
   // --------------------------------------------------------------------------
   unsigned char                                               m_iValueB;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: ?可选操作参数-C
   // --------------------------------------------------------------------------
   unsigned char                                               m_iValueC;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 可选操作参数-D
   // --------------------------------------------------------------------------
   unsigned char                                               m_iValueD;
      
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文长度
   // --------------------------------------------------------------------------
   unsigned char                                               m_iAmount;  
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文的CRC校验码
   // --------------------------------------------------------------------------
   unsigned short                                              m_iCRCode;
   
   // --------------------------------------------------------------------------
   // DESCRIPTION: 报文实体
   // --------------------------------------------------------------------------
   unsigned char                                               m_pBuffer[255];  
   
} NodeMsg;


// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#if defined ( __CC_ARM ) 

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#pragma pop

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
#endif



///////////////////////////////////////////////////////////////////////////////
//函数声明

unsigned short GetCoordinatorID (void);
//void  SendMessage(char* Psend, unsigned short iSize);
uint8_t   SendMessage(char* Psend, unsigned short iSize);
unsigned char  ReceiveMessageVerify(char*  pRecevBuff);
// -----------------------------------------------------------------------------
// DESCRIPTION: 是否是一个有效的报文，该报文必须有同步字符并且CRC验算正确
// -----------------------------------------------------------------------------
unsigned char IsValidNodeMsg( NodeMsg * pMsg );

// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
void UpdateNodeMsgCRC( NodeMsg * pMsg );
unsigned short CRC16( unsigned char * pMsg, unsigned short iSize );
// -----------------------------------------------------------------------------
// DESCRIPTION:
// -----------------------------------------------------------------------------
//void WriteNodeMsg( unsigned char hFile, NodeMsg * pMsg );


#endif

